<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portafolio de Diseño: Muestra de Proyectos Creativos</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="enlace.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    
    <header class="header">
        <div class="logo">PORTAFOLIO CREATIVO</div>
        <a href="javascript:history.back()" class="btn-back">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
            </svg>
            Regresar
        </a>
    </header>

    <section class="gallery">
        <h1>Muestra de Proyectos Creativos</h1>
        <div class="grid-container">
            <div class="grid-item" data-index="0" data-img="img/diseño_001.jpg">
                <img src="img/diseño_001.jpg" alt="Diseño 1">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="1" data-img="img/diseño_002.jpg">
                <img src="img/diseño_002.jpg" alt="Diseño 2">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="2" data-img="img/diseño_003.jpg">
                <img src="img/diseño_003.jpg" alt="Diseño 3">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="3" data-img="img/diseño_004.jpg">
                <img src="img/diseño_004.jpg" alt="Diseño 4">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="4" data-img="img/diseño_005.jpg">
                <img src="img/diseño_005.jpg" alt="Diseño 5">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="5" data-img="img/diseño_006.jpg">
                <img src="img/diseño_006.jpg" alt="Diseño 6">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="6" data-img="img/diseño_007.jpg">
                <img src="img/diseño_007.jpg" alt="Diseño 7">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="7" data-img="img/diseño_008.jpg">
                <img src="img/diseño_008.jpg" alt="Diseño 8">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="8" data-img="img/diseño_009.jpg">
                <img src="img/diseño_009.jpg" alt="Diseño 9">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="9" data-img="img/diseño_010.jpg">
                <img src="img/diseño_010.jpg" alt="Diseño 10">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="10" data-img="img/diseño_011.jpg">
                <img src="img/diseño_011.jpg" alt="Diseño 11">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="11" data-img="img/diseño_012.jpg">
                <img src="img/diseño_012.jpg" alt="Diseño 12">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="12" data-img="img/diseño_013.jpg">
                <img src="img/diseño_013.jpg" alt="Diseño 13">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="13" data-img="img/diseño_014.jpg">
                <img src="img/diseño_014.jpg" alt="Diseño 14">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="14" data-img="img/diseño_015.jpg">
                <img src="img/diseño_015.jpg" alt="Diseño 15">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="15" data-img="img/diseño_016.jpg">
                <img src="img/diseño_016.jpg" alt="Diseño 16">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="16" data-img="img/diseño_017.jpg">
                <img src="img/diseño_017.jpg" alt="Diseño 17">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="17" data-img="img/diseño_018.jpg">
                <img src="img/diseño_018.jpg" alt="Diseño 18">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="18" data-img="img/diseño_019.jpg">
                <img src="img/diseño_019.jpg" alt="Diseño 19">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="19" data-img="img/diseño_020.jpg">
                <img src="img/diseño_020.jpg" alt="Diseño 20">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="20" data-img="img/diseño_021.jpg">
                <img src="img/diseño_021.jpg" alt="Diseño 21">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="21" data-img="img/diseño_022.jpg">
                <img src="img/diseño_022.jpg" alt="Diseño 22">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="22" data-img="img/diseño_023.jpg">
                <img src="img/diseño_023.jpg" alt="Diseño 23">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="23" data-img="img/diseño_024.jpg">
                <img src="img/diseño_024.jpg" alt="Diseño 24">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="24" data-img="img/diseño_025.jpg">
                <img src="img/diseño_025.jpg" alt="Diseño 25">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="25" data-img="img/diseño_026.jpg">
                <img src="img/diseño_026.jpg" alt="Diseño 26">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="26" data-img="img/diseño_027.jpg">
                <img src="img/diseño_027.jpg" alt="Diseño 27">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            <div class="grid-item" data-index="27" data-img="img/diseño_028.jpg">
                <img src="img/diseño_028.jpg" alt="Diseño 28">
                <div class="overlay"><i class="fas fa-search-plus overlay-icon"></i></div>
            </div>
            
        </div>
    </section>

    <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div id="imageCarousel" class="carousel slide" data-ride="carousel" data-interval="false">
                        <div class="carousel-inner" id="carousel-inner-content">
                            </div>
                        <a class="carousel-control-prev" href="#imageCarousel" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Anterior</span>
                        </a>
                        <a class="carousel-control-next" href="#imageCarousel" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Siguiente</span>
                        </a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
    (function(){
        const STORAGE_KEY = 'gallery_v3';
        let ALL_PROJECTS = []; // Almacenará todos los proyectos (estáticos + dinámicos)

        // --- Funciones de Carga de Datos ---
        function loadUserImages() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        }

        function collectStaticProjects() {
            const staticItems = [];
            document.querySelectorAll('.grid-item[data-img]').forEach(item => {
                const imgElement = item.querySelector('img');
                staticItems.push({
                    src: item.getAttribute('data-img'),
                    alt: imgElement ? imgElement.alt : 'Proyecto Estático',
                    link: null, // Asumimos que los estáticos no tienen enlace externo
                    isStatic: true
                });
            });
            return staticItems;
        }

        function combineAllProjects() {
            const staticProjects = collectStaticProjects();
            const dynamicProjects = loadUserImages();
            // Los proyectos estáticos tienen data-index 0, 1, 2...
            // Los proyectos dinámicos continúan el índice a partir del último estático.
            ALL_PROJECTS = staticProjects.concat(dynamicProjects);
        }

        // --- Funciones de Renderizado ---
        function ensureGridContainer() {
            // (Tu función original para asegurar el contenedor para ítems dinámicos)
            let container = document.querySelector('.grid-container');
            if (!container) {
                const gallerySection = document.querySelector('.gallery') || document.body;
                container = document.createElement('div');
                container.className = 'grid-container';
                gallerySection.appendChild(container);
            }
            return container;
        }

        function renderUserImages() {
            // Esta función solo se encarga de renderizar los ítems dinámicos
            const users = loadUserImages();
            const container = ensureGridContainer();
            const staticCount = collectStaticProjects().length;

            // Eliminar imágenes dinámicas anteriores
            container.querySelectorAll('.grid-item[data-user="1"]').forEach(n => n.remove());

            users.forEach((u, index) => {
                const globalIndex = staticCount + index; // Calcular el índice global
                const div = document.createElement('div');
                div.className = 'grid-item';
                div.setAttribute('data-user', '1');
                div.setAttribute('data-index', globalIndex); // Asignar índice global

                // Crear imagen
                const img = document.createElement('img');
                img.src = u.src;
                img.alt = 'Proyecto Subido';
                img.loading = 'lazy';

                // Añadir overlay
                const overlay = document.createElement('div');
                overlay.className = 'overlay';
                overlay.innerHTML = '<i class="fas fa-search-plus overlay-icon"></i>';
                
                div.appendChild(img);
                div.appendChild(overlay);

                // Si hay enlace externo, envuelve todo en un <a>
                if (u.link && u.link.trim() !== '') {
                    const a = document.createElement('a');
                    a.href = u.link;
                    a.target = '_blank';
                    // Nota: Aquí se mantiene la lógica de enlace externo, pero al hacer clic
                    // se abrirá el enlace y NO el modal (comportamiento estándar).
                    a.appendChild(img); // El img ya tiene los estilos de overlay en el CSS
                } else {
                    // Si no tiene enlace, añade el evento click para abrir el modal carrusel
                    div.addEventListener('click', () => loadCarousel(globalIndex));
                }

                container.appendChild(div);
            });
        }

        // --- Funciones de Carrusel/Modal ---

        function loadCarousel(startIndex) {
            const carouselInner = document.getElementById('carousel-inner-content');
            carouselInner.innerHTML = ''; // Limpiar contenido anterior

            if (ALL_PROJECTS.length === 0) return;

            // Solo agregar la imagen clickeada
            const project = ALL_PROJECTS[startIndex];
            const item = document.createElement('div');
            item.className = 'carousel-item active';
            
            const img = document.createElement('img');
            img.src = project.src;
            img.alt = project.alt;

            item.appendChild(img);
            carouselInner.appendChild(item);

            // Destruir instancia anterior si existe
            $('#imageCarousel').carousel('dispose');
            
            // Re-inicializar el carrusel de Bootstrap
            $('#imageCarousel').carousel({
                interval: false,
                keyboard: true
            });
            
            // Mostrar el modal
            $('#imageModal').modal('show');
        }

        // --- Inicialización y Eventos ---
        window.addEventListener('load', () => {
            combineAllProjects(); // Recolecta todos los proyectos
            renderUserImages();   // Renderiza los dinámicos

            // Asignar evento click a los ítems estáticos
            document.querySelectorAll('.grid-item:not([data-user="1"])').forEach(item => {
                // Si el item tiene un enlace <a> dentro, no debe abrir el modal
                if (!item.querySelector('a')) {
                    const index = parseInt(item.getAttribute('data-index'));
                    item.addEventListener('click', () => loadCarousel(index));
                }
            });

            // Si cambia el localStorage (otra pestaña o admin), recarga los datos
            window.addEventListener('storage', e => {
                if (e.key === STORAGE_KEY) {
                    combineAllProjects();
                    renderUserImages();
                }
            });
        });

    })();
    </script>
</body>

</html>